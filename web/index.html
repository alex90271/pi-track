<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi-Track Network</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons@7.2.3/css/flag-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Col 1: Icon Sidebar -->
        <aside class="icon-sidebar">
            <div class="app-logo">
                <i class="bi bi-lightning-charge-fill"></i>
            </div>

            <div class="nav-icon-btn active" data-tab="live" title="Traffic Overview">
                <i class="bi bi-speedometer2"></i>
            </div>
            <div class="nav-icon-btn" data-tab="connections" title="Active Connections">
                <i class="bi bi-diagram-3"></i>
            </div>
            <div class="nav-icon-btn" data-tab="history" title="History Log">
                <i class="bi bi-clock-history"></i>
            </div>
            <div class="nav-icon-btn" data-tab="countries" title="Countries">
                <i class="bi bi-globe"></i>
            </div>

            <div style="margin-top: auto;"></div>
            <button class="theme-toggle" id="theme-toggle" title="Toggle Dark Mode">
                <i class="bi bi-moon-fill"></i>
            </button>
            <div class="nav-icon-btn" id="db-btn" title="Database Info">
                <i class="bi bi-database"></i>
            </div>
            <div class="nav-icon-btn" id="connection-status" title="Connection Status">
                <i class="bi bi-circle-fill" style="font-size: 8px;"></i>
            </div>
        </aside>

        <!-- Col 2: Filter/Nav Panel -->
        <aside class="filter-panel">
            <div class="filter-header">
                <div class="filter-title">Traffic Inspector</div>
                <div class="filter-subtitle" id="current-interface">eth0</div>
            </div>

            <!-- Global Stats Section -->
            <div class="panel-section">
                <div class="section-label">Throughput <i class="bi bi-chevron-down chevron"></i></div>
                <div class="mini-stats-grid">
                    <div class="mini-stat">
                        <div class="mini-stat-val" id="packets-per-sec">0</div>
                        <div class="mini-stat-label">Pkts/s</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-stat-val" id="bytes-per-sec">0 B/s</div>
                        <div class="mini-stat-label">Rate</div>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <div class="section-label">Totals <i class="bi bi-chevron-down chevron"></i></div>
                <div class="mini-stats-grid">
                    <div class="mini-stat">
                        <div class="mini-stat-val" id="total-packets">0</div>
                        <div class="mini-stat-label">Packets</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-stat-val" id="total-bytes">0 B</div>
                        <div class="mini-stat-label">Bytes</div>
                    </div>
                </div>
            </div>

            <!-- Protocols Section -->
            <div class="panel-section">
                <div class="section-label">Protocols <i class="bi bi-chevron-down chevron"></i></div>
                <div class="panel-chart" style="flex-wrap: wrap; gap: 10px;" id="protocol-circles">
                    <!-- JS Injected -->
                </div>
            </div>

            <!-- Traffic Chart Section -->
            <div class="panel-section">
                <div class="section-label">Traffic Rate <i class="bi bi-chevron-down chevron"></i></div>
                <div class="chart-container">
                    <canvas id="traffic-chart"></canvas>
                </div>
            </div>

            <!-- Filters Section (Only for Live tab really) -->
            <div class="panel-section" id="live-filters">
                <div class="section-label">Filters <i class="bi bi-chevron-down chevron"></i></div>
                <div class="time-filter-group">
                    <button class="time-pill" data-minutes="1">1m</button>
                    <button class="time-pill" data-minutes="5">5m</button>
                    <button class="time-pill active" data-minutes="10">10m</button>
                    <button class="time-pill" data-minutes="30">30m</button>
                </div>
                <input type="text" class="panel-input" id="packet-filter" placeholder="Search IPs, Ports...">
                <div style="display: flex; gap: 8px;">
                    <button class="panel-btn" id="pause-btn" style="flex: 1;"><i class="bi bi-pause-fill"></i>
                        Pause</button>
                    <button class="panel-btn" id="clear-btn" style="flex: 1;"><i class="bi bi-trash3"></i>
                        Clear</button>
                </div>
            </div>

            <!-- Top Talkers (Mini List) -->
            <div class="panel-section">
                <div class="section-label">Top Talkers <i class="bi bi-chevron-down chevron"></i></div>
                <div class="scrollable-list" id="talker-list">
                    <!-- JS Injected -->
                </div>
            </div>

            <!-- Top Processes -->
            <div class="panel-section">
                <div class="section-label">Top Processes <i class="bi bi-chevron-down chevron"></i></div>
                <div class="scrollable-list" id="process-list">
                    <!-- JS Injected -->
                </div>
            </div>
        </aside>

        <!-- Col 3: Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="content-header">
                <div>
                    <div class="content-title" id="page-title">Live Traffic</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);">Real-time packet inspection</div>
                </div>
                <div class="content-actions" style="gap: 1rem;">
                    <div class="live-indicator" id="live-indicator">
                        <span class="dot"></span>
                        <span>Live</span>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">
                        Uptime: <span id="uptime" style="font-family: monospace;">00:00:00</span>
                    </div>
                </div>
            </header>

            <!-- Views -->

            <!-- Live View -->
            <div class="view-pane active" id="tab-live">
                <div class="table-wrapper">
                    <table class="dense-table packet-table resizable">
                        <thead>
                            <tr>
                                <th class="col-time">Time</th>
                                <th class="col-ip">Source</th>
                                <th class="col-icon"></th>
                                <th class="col-ip">Destination</th>
                                <th>Protocol</th>
                                <th>Len</th>
                                <th>Process</th>
                                <th>Info</th>
                            </tr>
                        </thead>
                        <tbody id="packet-table-body">
                            <!-- JS Injected -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Connections View -->
            <div class="view-pane" id="tab-connections">
                <div class="table-wrapper">
                    <table class="dense-table connections-table">
                        <thead>
                            <tr>
                                <th class="col-ip">Source</th>
                                <th class="col-icon"></th>
                                <th class="col-ip">Destination</th>
                                <th>Protocol</th>
                                <th>Packets</th>
                                <th>Bytes</th>
                                <th>Duration</th>
                            </tr>
                        </thead>
                        <tbody id="connections-table-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- History View -->
            <div class="view-pane" id="tab-history">
                <div class="history-filter-bar">
                    <button class="panel-btn quick-filter-btn" data-days="1" style="width: auto;">24h</button>
                    <button class="panel-btn quick-filter-btn" data-days="7" style="width: auto;">7d</button>
                    <select class="panel-select" id="history-country" style="margin:0; width: 140px;">
                        <option value="">All Countries</option>
                        <!-- Populated by JS -->
                    </select>
                    <input type="text" class="panel-input" id="history-filter" placeholder="Search..."
                        style="margin:0; width: 200px;">
                    <input type="datetime-local" class="panel-input" id="history-start" style="margin:0; width: auto;">
                    <input type="datetime-local" class="panel-input" id="history-end" style="margin:0; width: auto;">
                    <button class="panel-btn" id="history-search-btn" style="width: auto;">Search</button>
                    <button class="export-btn" id="export-csv-btn" title="Export to CSV">
                        <i class="bi bi-download"></i> Export
                    </button>
                </div>
                <div class="table-wrapper">
                    <table class="dense-table packet-table">
                        <thead>
                            <tr>
                                <th class="col-time">Time</th>
                                <th class="col-ip">Source</th>
                                <th class="col-icon"></th>
                                <th class="col-ip">Destination</th>
                                <th>Protocol</th>
                                <th>Len</th>
                                <th>Process</th>
                                <th>Info</th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body"></tbody>
                    </table>
                </div>
                <div class="content-footer">
                    <button class="panel-btn" id="history-prev" style="width: auto;" disabled>Previous</button>
                    <span id="history-page-info">Page 1</span>
                    <span id="history-info">0 packets</span>
                    <button class="panel-btn" id="history-next" style="width: auto;">Next</button>
                </div>
            </div>

            <!-- Countries View -->
            <div class="view-pane" id="tab-countries">
                <div class="table-wrapper">
                    <table class="dense-table">
                        <thead>
                            <tr>
                                <th style="width:50px;">Flag</th>
                                <th>Country</th>
                                <th>Code</th>
                                <th>Bytes</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody id="country-table-body"></tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>

    <!-- Panel Toggle Button (Mobile) -->
    <button class="panel-toggle" id="panel-toggle">
        <i class="bi bi-sliders"></i>
    </button>

    <!-- Packet Detail Modal -->
    <div class="modal-overlay" id="packet-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Packet Details</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-grid" id="packet-details">
                    <!-- JS Injected -->
                </div>
            </div>
        </div>
    </div>

    <!-- Database Info Modal -->
    <div class="modal-overlay" id="db-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="bi bi-database" style="margin-right: 8px;"></i>Database Info</h3>
                <button class="modal-close" id="db-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="db-stats-grid" id="db-details">
                    <!-- JS Injected -->
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>